;; Build of the ReasonLIGO lexer as a library

(library
  (name lexing_reasonligo)
  (public_name ligo.lexing.reasonligo)
  (modules Token)
  (libraries
    ;; LIGO
    lexing_shared
    menhir_reasonligo_tokens
    lexing_reasonligo_self_units
    lexing_reasonligo_self_tokens
    ;; Third party
    str
    hex))

;; Build of a standalone lexer for ReasonLIGO

(executable
  (name LexerMain)
  (libraries
    ;; LIGO
    preprocessing_reasonligo
    lexing_shared
    lexing_reasonligo
    ;; Third party
    str)
  (modules Version LexerMain))

;; --------------------------------------------------------------------
;; Build of the unlexer (for covering the error states of the LR
;; automaton)

(executable
  (name Unlexer)
  (libraries
    ;; LIGO
    lexing_shared
    lexing_reasonligo
    ;; Third party
    str)
  (modules Unlexer))

;; --------------------------------------------------------------------
;; Build of the version source (for the user, as a CLI option)

(rule
 (targets Version.ml)
 (action
  (with-stdout-to
   Version.ml
   (run "sh" "-c" "printf 'let version = \"%s\"' \"${LIGO_VERSION}\""))))
