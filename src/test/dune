(ocamllex md)

(executables
 (names test doc_test repl_test parser_negative_tests vendors_test inference_test contract_test mydebugplease)
 (libraries simple-utils tezos-memory-proto-alpha ligo repl interpreter
   alcotest tezos-utils tezos-crypto)
)

(rule
 (alias doc-test)
 (action
  (run ./doc_test.exe))
 (deps
  (source_tree ../../gitlab-pages/docs)))

(rule
 (alias repl-test)
 (action
  (run ./repl_test.exe))
 (deps
  (source_tree ../../gitlab-pages/docs)))

(rule
 (alias parser-negative-tests)
 (action
  (run ./parser_negative_tests.exe))
 (deps ../passes/02-parsing/pascaligo/all.ligo
   ../passes/02-parsing/cameligo/all.mligo
   ../passes/02-parsing/reasonligo/all.religo))

(rule
  (alias ligo-test)
  (action (run ./test.exe))
  (deps (glob_files preprocessor/*))
)

(rule
  (alias vendors_test)
  (action (run ./vendors_test.exe))
)

(rule
  (alias inference_test)
  (action (run ./inference_test.exe))
)

(rule
  (alias contract_test)
  (action (setenv POSITIVE_CONTRACTS "%{pos}"
          (run ./contract_test.exe)))
  (deps (glob_files contracts/*)
        (:pos (glob_files contracts/positive/*))
        (glob_files contracts/negative/*)
        (glob_files preprocessor/*))
)

(alias
  (name runtest)
  (deps
    (alias vendors_test)
    (alias ligo-test)
    (alias doc-test)
    (alias parser-negative-tests)
    (alias repl-test)
    (alias inference_test)
    (alias contract_test)
  )
)

(rule
 (alias manual-test)
 (action
  (run ./manual_test.exe))
 (deps
  (glob_files contracts/*)))
